name: Agente v7 - ExtraÃ§Ã£o e AtualizaÃ§Ã£o DiÃ¡ria

on:
  schedule:
    # Roda diariamente Ã s 00:00 (hora UTC) - pega novos jogos
    - cron: '0 0 * * *'
    # Roda a cada 1 hora para atualizar resultados
    - cron: '0 * * * *'
  workflow_dispatch:  # Permite rodar manualmente

jobs:
  run-agent:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do repositÃ³rio
      - name: ğŸ“¦ Checkout cÃ³digo
        uses: actions/checkout@v3
      
      # 2. Setup Python
      - name: ğŸ Setup Python 3.13
        uses: actions/setup-python@v4
        with:
          python-version: '3.13'
      
      # 3. Cache de dependÃªncias
      - name: ğŸ’¾ Cache pip
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
      
      # 4. Instalar dependÃªncias
      - name: ğŸ“š Instalar bibliotecas
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pandas
      
      # 5. Download banco de dados (se existir)
      - name: ğŸ“¥ Download banco anterior
        continue-on-error: true
        run: |
          if [ -f apostas_academia.db ]; then
            echo "âœ… Banco de dados encontrado"
          else
            echo "â„¹ï¸  Novo banco serÃ¡ criado"
          fi
      
      # 6. Executar agente
      - name: ğŸ¤– Rodar Agente v7
        run: |
          python agente_v7.py
      
      # 7. Exibir log de execuÃ§Ã£o
      - name: ğŸ“‹ Mostrar logs
        if: always()
        run: |
          if [ -f agente_log.txt ]; then
            echo "=== ÃšLTIMAS 20 LINHAS DO LOG ==="
            tail -20 agente_log.txt
          fi
      
      # 8. Fazer commit e push (atualizar banco no repositÃ³rio)
      - name: ğŸ“¤ Fazer commit do banco
        if: always()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          if [ -f apostas_academia.db ]; then
            git add apostas_academia.db agente_log.txt
            git commit -m "ğŸ”„ AtualizaÃ§Ã£o automÃ¡tica: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" || true
            git push
          fi
